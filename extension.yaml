name: revenuecat-firebase-extension
version: 0.0.1
specVersion: v1beta  # Firebase Extensions specification version (do not edit)

displayName: RevenueCat Firebase Integration
description: RevenueCat is a scalable backend for in-app subscriptions and purchases.

license: apache-2.0

author:
  authorName: RevenueCat
  url: https://github.com/revenuecat

billingRequired: true

roles:
  - role: datastore.user
    reason: >-
      Allows RevenueCat to store Purchases information in Cloud Firestore.

resources:
  - name: handler
    type: firebaseextensions.v1beta.function
    description: >-
      Listens for RevenueCat server webhook requests, and store purchases information and events in Cloud Firestore.
    properties:
      location: ${LOCATION}
      runtime: nodejs14
      httpsTrigger: {}      

params:
  - param: LOCATION
    label: Cloud Functions location
    description: >-
      Where do you want to deploy the functions created for this extension?
      You usually want a location close to your database. For help selecting
      a location, refer to the [location selection guide](/docs/functions/locations).
    type: select
    options:
      - label: Iowa (us-central1)
        value: us-central1
      - label: South Carolina (us-east1)
        value: us-east1
      - label: Northern Virginia (us-east4)
        value: us-east4
      - label: Los Angeles (us-west2)
        value: us-west2
      - label: Salt Lake City (us-west3)
        value: us-west3
      - label: Las Vegas (us-west4)
        value: us-west4
      - label: Warsaw (europe-central2)
        value: europe-central2
      - label: Belgium (europe-west1)
        value: europe-west1
      - label: London (europe-west2)
        value: europe-west2
      - label: Frankfurt (europe-west3)
        value: europe-west3
      - label: Zurich (europe-west6)
        value: europe-west6
      - label: Hong Kong (asia-east2)
        value: asia-east2
      - label: Tokyo (asia-northeast1)
        value: asia-northeast1
      - label: Osaka (asia-northeast2)
        value: asia-northeast2
      - label: Seoul (asia-northeast3)
        value: asia-northeast3
      - label: Mumbai (asia-south1)
        value: asia-south1
      - label: Jakarta (asia-southeast2)
        value: asia-southeast2
      - label: Montreal (northamerica-northeast1)
        value: northamerica-northeast1
      - label: Sao Paulo (southamerica-east1)
        value: southamerica-east1
      - label: Sydney (australia-southeast1)
        value: australia-southeast1
    default: us-east1
    required: true
    immutable: true
  - param: REVENUECAT_EVENTS_COLLECTION
    label: RevenueCat Webhook Events Firestore collection
    description: >-
      What is the path to the Cloud Firestore collection where the extension should store RevenueCat events?
      Leave empty if you do not want the extension to store RevenueCat events.

      (You can later modify this value in Google Firestore > Extensions > Extension Configuration > Reconfigure extension)
    validationRegex: "^[^/]+(/[^/]+/[^/]+)*$"
    validationErrorMessage: Firestore collection paths must be an odd number of segments separated by slashes, e.g. "path/to/collection".
    required: false
  - param: REVENUECAT_CUSTOMERS_COLLECTION
    label: Location of the customers collection
    description: >-
      What is the path to the Cloud Firestore collection where the extension should store RevenueCat customer details?
      This can be the location of an existing user collection, the extension will not overwrite your existing data but rather merge the RevenueCat data into your existing firestore documents.
      Leave empty if you do not want the extension to store RevenueCat customer details.
      
      (You can later modify this value in Google Firestore > Extensions > Extension Configuration > Reconfigure extension)
    validationRegex: "^[^/]+(/[^/]+/[^/]+)*$"
    validationErrorMessage: Firestore collection paths must be an odd number of segments separated by slashes, e.g. "path/to/collection".
    required: false    
  - param: REVENUECAT_SHARED_SECRET
    label: RevenueCat Firebase Integration Shared Secret
    description: >-
      What is the webhook shared secret for the Firebase integration of your RevenueCat project?
      You will find this in the RevenueCat dashboard under Projects > [your project] > Integrations > Firebase
    example: my_shared_secret
    validationRegex: "^.+$"
    required: true
